library("igraph")
## Q1
filename="E:\\Punit\\D\\UCLA\\Spring16\\CS232EE\\Code\\ee232e-graphs-networks\\HW-3\\sorted_directed_net.txt"
g = read_graph(file = filename ,format = "ncol",directed = T)
con = is.connected(g)
clusters = components(g)
gccInd = which.max(clusters$csize)
nonGccNodes = (1:gorder(g))[clusters$membership != gccInd]
gcc = delete.vertices(g,nonGccNodes)

## Q2

in_degree = degree_distribution(gcc,mode="in")
out_degree = degree_distribution(gcc,mode="out")
par(mfrow=c(1,2))
plot(in_degree, type='l', col='red', main = "In - Degree Distribution of gcc ",xlab="degree",ylab="density")
plot(out_degree, type='l',col='blue', main = "Out - Degree Distribution of gcc ",xlab="degree",ylab="density")

#####################################################
in_degree = degree(gcc,mode="in")
out_degree = degree(gcc,mode="out")
par(mfrow=c(1,2))
#hist(in_degree, breaks=100,main ="In-Degree Distribution of GCC", xlab="degree",ylab="density")
#hist(out_degree, breaks=100,main ="Out-Degree Distribution of GCC", xlab="degree",ylab="density")
plot(in_degree, type='l', col='red', main = "In - Degree Distribution of gcc ",xlab="degree",ylab="density")
plot(out_degree, type='l',col='blue', main = "Out - Degree Distribution of gcc ",xlab="degree",ylab="density")
###################################################

## Q3
#option #1
undirected_g1 = as.undirected(gcc,mode = "each")
lpc_g1 = label.propagation.community(undirected_g1)
commsizes_lpc_g1=sizes(lpc_g1)
mod_lpc_g1 = lpc_g1$modularity
plot(lpc_g1,undirected_g1,main="Comm Structure using Label Prop")

#option #2
sqrtweight<-function(weight){
  #new_weight = sqrt(weight[1]*weight[2])
  new_weight = sqrt(prod(weight))
  new_weight
}
undirected_g2 = as.undirected(gcc,mode = "collapse",edge.attr.comb = sqrtweight)
fg_g2 = fastgreedy.community(undirected_g2)
commsizes_fg_g2=sizes(fg_g2)
mod_fg_g2 = fg_g2$modularity
plot(fg_g2,undirected_g2,main="Comm Structure using Fast Greedy")


lpc_g2 = label.propagation.community(undirected_g2)
commsizes_lpc_g2=sizes(lpc_g2)
mod_lpc_g2 = lpc_g2$modularity
plot(lpc_g2,undirected_g2,main="Comm Structure using Label Prop")

## Q4
maxSizeCommIndex = which.max(commsizes_fg_g2)
non_subcmp_nodes = (1:gorder(undirected_g2))[fg_g2$membership != maxSizeCommIndex]
sub_community = delete.vertices(undirected_g2,non_subcmp_nodes)

fg_sub_community = fastgreedy.community(sub_community)
commsizes_fg_subcomm=sizes(fg_sub_community)
hist(fg_sub_community$modularity)
print(commsizes_fg_subcomm)
plot(fg_sub_community,sub_community,main="Sub Community Structure using Fast Greedy")

lp_sub_community = label.propagation.community(sub_community)
commsizes_lp_subcomm=sizes(lp_sub_community)
hist(lp_sub_community$modularity)
print(commsizes_lp_subcomm)
plot(lp_sub_community,sub_community,main="Sub Community Structure using Label Prop")

